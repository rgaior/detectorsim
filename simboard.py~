import matplotlib.pyplot as plt
import matplotlib
matplotlib.rc('xtick', labelsize=15)
matplotlib.rc('ytick', labelsize=15)
import numpy as np
import os
import sys
cwd = os.getcwd()
classpath = cwd + '/../classes/'
utilspath = cwd + '/../utils/'
sys.path.append(utilspath)
sys.path.append(classpath)
import utils
import simulation
import detector
import waveform
#temp, gain, bw, tau of power det
#datafolder = '/Users/romain/work/Auger/EASIER/LPSC/filter/data/2013_05_10/Capa/'
#datafolder = '/Users/romain/work/Auger/EASIER/LPSC/filter/data/2013_05_10/NoCapa/'
datafolder = '/Users/romain/work/Auger/EASIER/LPSC/filter/data/2013_03_25/HF_box/'
filenameRF = 'C1hf10mVbox200mV00002.txt'
filenamePD = 'C2hf10mVbox200mV00002.txt'
#filenameRF = 'C110mVNoCapa00001.txt'
#filenamePD = 'C210mVNoCapa00001.txt'
wfRF = utils.readscopefile(datafolder+filenameRF)
wfPD = utils.readscopefile(datafolder+filenamePD)
plt.subplot(211)
plt.plot(wfRF[0],wfRF[1])
plt.subplot(212)
plt.plot(wfPD[0],wfPD[1])

tsys = 50
gain = 1e6
f1 = 0.95e9
f2 = 1.75e9
det = detector.Detector(tsys, gain, f1, f2, 5e-9)

sim = simulation.Simulation(det=det,sampling=5e9)
sim.noise = wfPD[1]
sim.time = wfPD[0]
simwf = waveform.Waveform(sim.time,sim.noise, type='board')
afterFEfilter = det.FEfilter(simwf)
timesampled = det.FEtimesampling(afterFEfilter)
wf = det.FEampsampling(timesampled)
#rms_temp = np.append(rms_temp,np.std(wf.amp))


sim2 = simulation.Simulation(det=det,sampling=5e9)
sim2.noise = wfRF[1]
sim2.time = wfRF[0]
simwf2 = waveform.Waveform(sim2.time,sim2.noise, type='hf')
logresponse = det.produceresponse(simwf2)
afterpd = det.powerdetlinear(logresponse)
afterboard = det.adaptationboard(afterpd)
afterFEfilter2 = det.FEfilter(afterboard)
timesampled2 = det.FEtimesampling(afterFEfilter2)
wf2 = det.FEampsampling(timesampled2)





fig = plt.figure()
plt.plot(wf.time,wf.amp)
plt.plot(wf2.time,wf2.amp)
print np.std(wf.amp)
print np.std(wf2.amp)

plt.show()
